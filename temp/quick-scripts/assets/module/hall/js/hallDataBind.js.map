{"version":3,"sources":["hallDataBind.js"],"names":["WJFCommon","require","cc","Class","extends","properties","username","default","type","Label","goldcoins","cards","headimg","Node","message","backRoomImg","SpriteFrame","backRoom","onLoad","ready","weijifen","browserType","WXorBlow","shareRoom","paystatus","alert","user","nickname","Date","parse","string","headImg","headimgurl","http","httpGet","authorization","roomSuccess","roomError","cardsucess","carderror","gundongText","tzsucess","tzerror","result","object","data","JSON","tz","hall","room","getGame","sprite","getComponent","Sprite","spriteFrame","self","text","width","node","parent","runAction","repeatForever","sequence","moveTo","p","y","callFunc","x","createRoom","director","loadScene","joinInRoom"],"mappings":";;;;;;AAAA,IAAIA,YAAYC,QAAQ,WAAR,CAAhB;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASJ,SADJ;;AAGLK,gBAAY;AACRC,kBAAU;AACNC,qBAAS,IADH;AAENC,kBAAMN,GAAGO;AAFH,SADF;AAKRC,mBAAW;AACPH,qBAAS,IADF;AAEPC,kBAAMN,GAAGO;AAFF,SALH;AASRE,eAAO;AACHJ,qBAAS,IADN;AAEHC,kBAAMN,GAAGO;AAFN,SATC;AAaRG,iBAAQ;AACJL,qBAAQ,IADJ;AAEJC,kBAAKN,GAAGW;AAFJ,SAbA;AAiBRC,iBAAQ;AACbP,qBAAS,IADI;AAEJC,kBAAMN,GAAGO;AAFL,SAjBA;AAqBdM,qBAAY;AACXR,qBAAQ,IADG;AAEXC,kBAAKN,GAAGc;AAFG,SArBE;AAyBRC,kBAAUf,GAAGW;AAzBL,KAHP;AA8BLK,YAAQ,kBAAY;;AAEhB;AACA,YAAG,KAAKC,KAAL,EAAH,EAAgB;AACZ;AACA,gBAAGjB,GAAGkB,QAAH,CAAYC,WAAZ,IAAyB,QAA5B,EAAqC;AACjCnB,mBAAGkB,QAAH,CAAYE,QAAZ,CAAqBC,SAArB;AACH;AACD;AACA,gBAAGrB,GAAGkB,QAAH,CAAYI,SAAf,EAAyB;AACrB,oBAAItB,GAAGkB,QAAH,CAAYI,SAAZ,IAAuB,MAA3B,EAAkC;AAC9B,yBAAKC,KAAL,CAAW,MAAX;AACAvB,uBAAGkB,QAAH,CAAYI,SAAZ,GAAwB,IAAxB;AACH,iBAHD,MAGK;AACD,yBAAKC,KAAL,CAAW,MAAX;AACAvB,uBAAGkB,QAAH,CAAYI,SAAZ,GAAwB,IAAxB;AACH;AACJ;AACD;AACT,gBAAGtB,GAAGkB,QAAH,CAAYM,IAAZ,CAAiBC,QAAjB,IAA6B,IAA7B,IAAqCzB,GAAGkB,QAAH,CAAYM,IAAZ,CAAiBC,QAAjB,IAA6B,EAArE,EAAwE;AACvEzB,mBAAGkB,QAAH,CAAYM,IAAZ,CAAiBC,QAAjB,GAA4B,QAAMC,KAAKC,KAAL,CAAW,IAAID,IAAJ,EAAX,CAAlC;AACA;;AAEQ;AACA;AACA,iBAAKtB,QAAL,CAAcwB,MAAd,GAAuB5B,GAAGkB,QAAH,CAAYM,IAAZ,CAAiBC,QAAxC;AACA;AACT,iBAAKI,OAAL,CAAa,KAAKnB,OAAlB,EAA0BV,GAAGkB,QAAH,CAAYM,IAAZ,CAAiBM,UAA3C,EAAsD,IAAtD;AACS;AACA;AACA;AACA9B,eAAGkB,QAAH,CAAYa,IAAZ,CAAiBC,OAAjB,CAAyB,kCAAgChC,GAAGkB,QAAH,CAAYe,aAArE,EAAmF,KAAKC,WAAxF,EAAoG,KAAKC,SAAzG,EAAmH,IAAnH;;AAEAnC,eAAGkB,QAAH,CAAYa,IAAZ,CAAiBC,OAAjB,CAAyB,mCAAiChC,GAAGkB,QAAH,CAAYe,aAAtE,EAAoF,KAAKG,UAAzF,EAAoG,KAAKC,SAAzG,EAAmH,IAAnH;AACA,iBAAKC,WAAL;AACA;AACAtC,eAAGkB,QAAH,CAAYa,IAAZ,CAAiBC,OAAjB,CAAyB,0CAAwChC,GAAGkB,QAAH,CAAYe,aAA7E,EAA2F,KAAKM,QAAhG,EAAyG,KAAKC,OAA9G,EAAsH,IAAtH;AACH;AACD;AAEH,KAtEI;AAuELH,eAAW,mBAASI,MAAT,EAAgBC,MAAhB,EAAuB;AAC9B;AACH,KAzEI;AA0ELN,gBAAW,oBAASK,MAAT,EAAgBC,MAAhB,EAAuB;AAC9B,YAAIC,OAAOC,KAAKjB,KAAL,CAAWc,MAAX,CAAX;AACIzC,WAAGkB,QAAH,CAAYM,IAAZ,CAAiBf,KAAjB,GAAyBkC,KAAKlC,KAA9B;AACAiC,eAAOjC,KAAP,CAAamB,MAAb,GAAsB5B,GAAGkB,QAAH,CAAYM,IAAZ,CAAiBf,KAAvC;AACAiC,eAAOlC,SAAP,CAAiBoB,MAAjB,GAA0B5B,GAAGkB,QAAH,CAAYM,IAAZ,CAAiBhB,SAA3C;AAEP,KAhFI;AAiFL+B,cAAU,kBAASE,MAAT,EAAgBC,MAAhB,EAAuB;AACnC,YAAIC,OAAOC,KAAKjB,KAAL,CAAWc,MAAX,CAAX;AACM,YAAGE,KAAKE,EAAR,EAAW;AACPH,mBAAOI,IAAP,CAAY,CAAZ;AACH;AACP,KAtFO;AAuFRN,aAAS,iBAASC,MAAT,EAAgBC,MAAhB,EAAuB,CAC5B,CAxFI;AAyFLR,iBAAa,qBAASO,MAAT,EAAgBC,MAAhB,EAAuB;AAChC;AACN,YAAIC,OAAOC,KAAKjB,KAAL,CAAWc,MAAX,CAAX;AACM,YAAGE,KAAKI,IAAR,EAAa;AAClBL,mBAAOM,OAAP,CAAeL,IAAf;AACS,gBAAIM,SAASP,OAAO3B,QAAP,CAAgBmC,YAAhB,CAA6BlD,GAAGmD,MAAhC,CAAb;AACHF,mBAAOG,WAAP,GAAqBV,OAAO7B,WAA5B;AACA,SAJD,MAIO;AACZb,eAAGkB,QAAH,CAAY6B,IAAZ,GAAmB,IAAnB;AACA;AAEE,KApGI;AAqGLZ,eAAW,mBAASO,MAAT,EAAgB;AACvBA,eAAOnB,KAAP,CAAa,MAAb;AACH,KAvGI;AAwGR;AACAe,iBAAY,uBAAU;AACf;AACN,YAAIe,OAAO,IAAX;AACM,YAAIC,OAAOD,KAAKzC,OAAhB;AACA,YAAI2C,QAAQF,KAAKzC,OAAL,CAAa4C,IAAb,CAAkBC,MAAlB,CAAyBF,KAArC;AACAD,aAAKE,IAAL,CAAUE,SAAV,CAAoB1D,GAAG2D,aAAH,CAAiB3D,GAAG4D,QAAH,CACjC5D,GAAG6D,MAAH,CAAUP,KAAKE,IAAL,CAAUD,KAAV,GAAgBA,KAAhB,GAAsB,EAAhC,EAAmCvD,GAAG8D,CAAH,CAAK,CAACR,KAAKE,IAAL,CAAUD,KAAX,GAAiBA,QAAM,CAA5B,EAA8BD,KAAKE,IAAL,CAAUO,CAAxC,CAAnC,CADiC,EAEjC/D,GAAGgE,QAAH,CAAY,YAAU;AAClBV,iBAAKE,IAAL,CAAUS,CAAV,GAAcV,KAAd;AACH,SAFD,CAFiC,CAAjB,CAApB,EAKG,IALH;AAMN,KApHO;AAqHR;AACAW,gBAAW,sBAAU;AACd;AACN,YAAGlE,GAAGkB,QAAH,CAAY6B,IAAZ,IAAmB,MAAnB,IAA4B/C,GAAGkB,QAAH,CAAY6B,IAAZ,IAAoB,IAAnD,EAAwD;AACvD/C,eAAGmE,QAAH,CAAYC,SAAZ,CAAsB,SAAtB,EADuD,CACtB;AACjC,SAFD,MAEK;AACJ,iBAAKtB,IAAL,CAAU,EAAV;AACA;AACD,KA7HO;AA8HR;AACAuB,gBAAW,sBAAU;AACd,aAAKvB,IAAL,CAAU,EAAV;AACN;;;;;;AAMA;;AAvIO,CAAT","file":"hallDataBind.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\module\\hall\\js","sourcesContent":["var WJFCommon = require(\"WJFCommon\");\r\ncc.Class({\r\n    extends: WJFCommon,\r\n\r\n    properties: {\r\n        username: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        goldcoins: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        cards: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        headimg:{\r\n            default:null,\r\n            type:cc.Node\r\n        },     \r\n        message:{\r\n\t\t\tdefault: null,\r\n            type: cc.Label\r\n\t\t},\r\n\t\tbackRoomImg:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.SpriteFrame\r\n        },  \r\n        backRoom: cc.Node,\r\n    },\r\n    onLoad: function () {\r\n        \r\n        //如果weijifen已经加载好了\r\n        if(this.ready()){   \r\n            //重置分享按钮的设置\r\n            if(cc.weijifen.browserType==\"wechat\"){\r\n                cc.weijifen.WXorBlow.shareRoom();\r\n            }   \r\n            //如果有这个变量代表之前有充值 且充值成功\r\n            if(cc.weijifen.paystatus){\r\n                if( cc.weijifen.paystatus=='true'){\r\n                    this.alert('充值成功');\r\n                    cc.weijifen.paystatus = null;\r\n                }else{\r\n                    this.alert('充值失败');\r\n                    cc.weijifen.paystatus = null;\r\n                }  \r\n            };\r\n            //玩家名字 没有时设置为游客\r\n\t\t\tif(cc.weijifen.user.nickname == null || cc.weijifen.user.nickname == \"\"){\r\n\t\t\t\tcc.weijifen.user.nickname = \"游客_\"+Date.parse(new Date());\r\n\t\t\t}\r\n\r\n            // this.username ? this.username = {} : this.username={};\r\n            //debugger\r\n            this.username.string = cc.weijifen.user.nickname;\r\n            //玩家头像\r\n\t\t\tthis.headImg(this.headimg,cc.weijifen.user.headimgurl,true);\r\n            // this.cards.string = cc.weijifen.user.cards + \"张\" ;\r\n            // this.goldcoins.string = cc.weijifen.user.goldcoins + '个';\r\n            //请求获取当前用户是否已经参加了房间\r\n            cc.weijifen.http.httpGet('/api/room/reConnection?token='+cc.weijifen.authorization,this.roomSuccess,this.roomError,this);\r\n\r\n            cc.weijifen.http.httpGet('/api/room/queryRoomCard?token='+cc.weijifen.authorization,this.cardsucess,this.carderror,this)   \r\n            this.gundongText();\r\n            //获取是否有新的通知\r\n            cc.weijifen.http.httpGet('/activity/findActivityListGame?token='+cc.weijifen.authorization,this.tzsucess,this.tzerror,this);            \r\n        }\r\n        // console.log('cc.weijifen---handDataBind',cc.weijifen)\r\n\r\n    },\r\n    carderror: function(result,object){\r\n        // this.alert('充值失败');\r\n    },\r\n    cardsucess:function(result,object){\r\n        var data = JSON.parse(result) ;\r\n            cc.weijifen.user.cards = data.cards;\r\n            object.cards.string = cc.weijifen.user.cards ;\r\n            object.goldcoins.string = cc.weijifen.user.goldcoins;\r\n\r\n    },\r\n    tzsucess: function(result,object){\r\n\t\tvar data = JSON.parse(result);  \r\n        if(data.tz){\r\n            object.hall(3);\r\n        }\r\n\t},\r\n\ttzerror: function(result,object){\t\r\n    },\r\n    roomSuccess: function(result,object){\r\n        // debugger\r\n\t\tlet data = JSON.parse(result);\r\n        if(data.room){\r\n\t\t\tobject.getGame(data);\r\n            var sprite = object.backRoom.getComponent(cc.Sprite);\r\n        \tsprite.spriteFrame = object.backRoomImg;\r\n        } else {\r\n\t\t\tcc.weijifen.room = null;\r\n\t\t}\r\n        \r\n    },\r\n    roomError: function(object){\r\n        object.alert(\"网络异常\");\r\n    },\r\n\t//滚动公告字幕\r\n\tgundongText:function(){\r\n        //debugger\r\n\t\tvar self = this;\r\n        var text = self.message;\r\n        var width = self.message.node.parent.width;\r\n        text.node.runAction(cc.repeatForever(cc.sequence(\r\n            cc.moveTo(text.node.width/width*10,cc.p(-text.node.width-width/5,text.node.y)),\r\n            cc.callFunc(function(){\r\n                text.node.x = width;\r\n            })\r\n        )),1000);\t\r\n\t},\r\n\t//创建包厢\r\n\tcreateRoom:function(){\r\n        //当前玩家不存在未结束的游戏   \r\n\t\tif(cc.weijifen.room !='null' &&cc.weijifen.room != null){\r\n\t\t\tcc.director.loadScene('majiang');// 通过场景名加载场景\r\n\t\t}else{\r\n\t\t\tthis.hall(11);\r\n\t\t}\t\t\r\n\t},\r\n\t//加入包厢\r\n\tjoinInRoom:function(){\r\n        this.hall(10);\r\n\t\t/*if(cc.weijifen.room !='null' &&cc.weijifen.room != null){\r\n\t\t\tcc.director.loadScene('majiang');\r\n\t\t}else{\r\n            cc.director.loadScene('majiang');\r\n\t\t\t// this.hall(10);\r\n      \t}*/\r\n\t},\r\n\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}