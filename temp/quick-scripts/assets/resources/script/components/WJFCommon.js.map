{"version":3,"sources":["WJFCommon.js"],"names":["cc","Class","extends","Component","properties","onLoad","ready","check","weijifen","scene","connect","disconnect","socket","window","io","http","wsURL","ondisconnect","console","log","getCommon","common","object","find","getComponent","loadding","size","loaddingDialog","get","parent","_animCtrl","Animation","animState","play","alert","message","dialog","alertdialog","node","getChildByName","Label","string","closeloadding","put","closealert","name","self","director","preloadScene","loadScene","root","decode","data","cards","Array","sys","isNative","dataView","DataView","i","byteLength","getInt8","Base64","require","strArray","length","parse","result","JSON","reset","token","id","authorization","user","playUser","game","games","playway","localStorage","logout","destroy","map","command","callback","routes","route","talkPlay","talkRecord","ab2str","buf","String","fromCharCode","apply","Uint8Array","str2ab","str","ArrayBuffer","bufView","strLen","charCodeAt","getGame","room","match","playerNum","cardNum","maxRound","headImg","img","pic","bol","imgurl","sprite","Sprite","loader","load","url","type","err","texture","spriteFrame","SpriteFrame","width","height","radius","hall","num","menu","single","init","wrong"],"mappings":"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","file":"WJFCommon.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\script\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       \r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        \r\n    },\r\n    //判断是否有初始化创建wjf全局变量\r\n    ready:function(){\r\n        var check = false ;\r\n        if(cc.weijifen){\r\n            check = true ;\r\n        }else{\r\n            this.scene(\"login\" , this) ;\r\n        }\r\n        return check ;\r\n    },\r\n    connect:function(){\r\n        /**\r\n         * 登录成功后，创建 Socket链接，\r\n         */\r\n        this.disconnect();\r\n        cc.weijifen.socket = window.io.connect(cc.weijifen.http.wsURL + '/bm/game');\r\n        cc.weijifen.socket.ondisconnect = function(){\r\n            console.log('user disconnected');\r\n        };\r\n        return cc.weijifen.socket ;\r\n    },\r\n    disconnect:function(){\r\n        if(cc.weijifen.socket != null){\r\n            cc.weijifen.socket.disconnect();\r\n            cc.weijifen.socket = null ;\r\n        }\r\n    },\r\n    getCommon:function(common){\r\n        var object = cc.find(\"Canvas/script/\"+common) ;\r\n        return object.getComponent(common);\r\n    },\r\n    loadding:function(){\r\n        if(cc.weijifen.loadding.size() > 0){\r\n            this.loaddingDialog = cc.weijifen.loadding.get();\r\n            this.loaddingDialog.parent = cc.find(\"Canvas\");\r\n\r\n            this._animCtrl = this.loaddingDialog.getComponent(cc.Animation);\r\n            var animState = this._animCtrl.play(\"loadding\");\r\n        }\r\n    },\r\n    alert:function(message){\r\n        if(cc.weijifen.dialog.size() > 0){\r\n            this.alertdialog = cc.weijifen.dialog.get();\r\n            this.alertdialog.parent = cc.find(\"Canvas\");\r\n            let node = this.alertdialog.getChildByName(\"message\") ;\r\n            if(node!=null && node.getComponent(cc.Label)){\r\n                node.getComponent(cc.Label).string = message ;\r\n            }\r\n        }\r\n        return this.alertdialog;\r\n    },\r\n    closeloadding:function(){\r\n        cc.weijifen.loadding.put(cc.find(\"Canvas/loadding\"));\r\n    },\r\n    closealert:function(){\r\n        if(cc.find(\"Canvas/alert\")){\r\n            cc.weijifen.dialog.put(cc.find(\"Canvas/alert\"));\r\n        }\r\n    },\r\n    scene:function(name , self){\r\n        cc.director.preloadScene(name, function () {\r\n            if(cc.weijifen){\r\n                self.closeloadding(self.loaddingDialog);\r\n            }\r\n            cc.director.loadScene(name);\r\n        });\r\n    },\r\n    root:function(){\r\n        return cc.find(\"Canvas\");\r\n    },\r\n    decode:function(data){\r\n        var cards = new Array();\r\n        if(!cc.sys.isNative) {\r\n            var dataView = new DataView(data);\r\n            for(var i= 0 ; i<data.byteLength ; i++){\r\n                cards[i] = dataView.getInt8(i);\r\n            }\r\n        }else{\r\n            var Base64 = require(\"Base64\");\r\n            var strArray = Base64.decode(data) ;\r\n            if(strArray && strArray.length > 0){\r\n                for(var i= 0 ; i<strArray.length ; i++){\r\n                    cards[i] = strArray[i];\r\n                }\r\n            }\r\n        }\r\n        return cards ;\r\n    },\r\n    parse(result){\r\n        var data ;\r\n        if(!cc.sys.isNative){\r\n            data = result;\r\n        }else{\r\n            data = JSON.parse(result) ;\r\n        }\r\n        return data ;\r\n    },\r\n    reset:function(data , result){\r\n        //放在全局变量\r\n        if ( data.token ) {\r\n            if ( data.token.id ) {\r\n                cc.weijifen.authorization = data.token.id;\r\n            } else {\r\n                cc.weijifen.authorization = data.token;\r\n            }\r\n        };\r\n    \r\n        if(data.data){\r\n            cc.weijifen.user = data.data ;\r\n        }\r\n        if(data.playUser){\r\n            cc.weijifen.user = data.playUser;\r\n        }\r\n        \r\n        if(data.game){\r\n            cc.weijifen.games = data.games ;\r\n        }\r\n        cc.weijifen.playway = null ;\r\n        cc.weijifen.localStorage.put(\"userinfo\" ,result );\r\n    },\r\n    logout:function(){\r\n        if(cc.weijifen.dialog != null){\r\n            cc.weijifen.dialog.destroy();\r\n            cc.weijifen.dialog = null ;\r\n        }\r\n        cc.weijifen.authorization = null ;\r\n        cc.weijifen.user = null ;\r\n        cc.weijifen.games = null ;\r\n\r\n        cc.weijifen.playway = null ;\r\n\r\n        this.disconnect();\r\n    },\r\n    socket:function(){\r\n        let socket = cc.weijifen.socket ;\r\n        if(socket == null){\r\n            socket = this.connect();\r\n        }\r\n        return socket ;\r\n    },\r\n    map:function(command, callback){\r\n        this.routes[command] = callback || function(){};\r\n    },\r\n    route:function(command){\r\n        return this.routes[command] || function(){};\r\n    },\r\n    talkPlay:function(){},\r\n    talkRecord:function(){},\r\n    ab2str: function(buf) {\r\n        return String.fromCharCode.apply(null, new Uint8Array(buf));\r\n    },\r\n    str2ab: function(str) {\r\n        var buf = new ArrayBuffer(str.length*2); // 每个字符占用2个字节\r\n        var bufView = new Uint8Array(buf);\r\n        for (var i=0, strLen=str.length; i<strLen; i++) {\r\n             bufView[i] = str.charCodeAt(i);\r\n        }\r\n        return buf;\r\n    },\r\n    getGame: function(data,room){\r\n        if(data.match){\r\n            cc.weijifen.match = data.match ; \r\n        }\r\n        if(data.room){\r\n            cc.weijifen.room = data.room;\r\n        }else if(room){\r\n            cc.weijifen.room = data.room;\r\n        }\r\n        if(data.playway){\r\n            cc.weijifen.playway = data.playway;\r\n        }\r\n        if(data.playerNum){\r\n            cc.weijifen.playerNum = data.playerNum;\r\n        }\r\n        if(data.cardNum){\r\n            cc.weijifen.cardNum = data.cardNum;\r\n        }\r\n        if(data.maxRound){\r\n            cc.weijifen.maxRound = data.maxRound;\r\n        }\r\n    },\r\n    //加载玩家头像\r\n    headImg: function(img,pic,bol){\r\n        if(pic){\r\n            let imgurl = pic;\r\n            let sprite = img.getComponent(cc.Sprite);\r\n            cc.loader.load({url:imgurl,type:'jpg'},function(err,texture){\r\n                sprite.spriteFrame = new cc.SpriteFrame(texture);\r\n                img.width = 64;\r\n                img.height = 64;\r\n                if(bol == true){\r\n                    img.radius = 10;\r\n                }\r\n            })\r\n        } \r\n    },\r\n    //点击打开弹窗\r\n    hall:function(num){\r\n\t\tlet menu = cc.weijifen.menu.get();//拿到公用弹框PreFab\r\n        let single = menu.getComponent('menuSet');//获取当前PreFab中名字为menuSet  js文件\r\n        menu.parent = cc.find('Canvas');// 将节点放在Canvas节点下面。\r\n        single.init(num);//调用js文件中的init方法\r\n    },\r\n    wrong: function(){\r\n        let menu = cc.find(\"Canvas/menu\") ;// 在cocos对象下找到menu节点\r\n        cc.weijifen.menu.put(menu);\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n"]}