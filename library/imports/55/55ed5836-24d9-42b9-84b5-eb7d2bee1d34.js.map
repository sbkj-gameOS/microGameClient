{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\..\\assets\\module\\majiang\\js\\gamePlay\\card/assets\\module\\majiang\\js\\gamePlay\\card\\TakeMJCard.js"],"names":["cc","Class","extends","Component","properties","target","default","type","Node","tape","Button","onLoad","node","on","touchendClick","mouseupClick","event","console","log","y","sys","localStorage","getItem","x","dispatchEvent","Event","EventCustom","removeItem","card","parent","getComponent","caishen","delta","touch","getDelta","setItem","onClick","context","find","handCards","self","weijifen","click","huifu","take","tings","tingSelect","active","tinglength","children","length","i","destroy","cardvalue","color","Color","chuqu","j","cv","parseInt","value","mjtype","tingcards","decode","cards","s","limian","instantiate","tingSelectch","cccc","init","button","cardNum","width","height","interactable"],"mappings":"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","file":"TakeMJCard.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\module\\majiang\\js\\gamePlay\\card","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        target:{\r\n            default:null ,\r\n            type : cc.Node\r\n        },\r\n        tape:cc.Button,\r\n        \r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.tape.node.on('touchmove',this.touchendClick, this);\r\n        this.tape.node.on('touchend',this.mouseupClick, this);\r\n        \r\n    },\r\n    mouseupClick: function(event){\r\n        console.log(this.y);\r\n        if(cc.sys.localStorage.getItem('delta')>90){\r\n            event.target.x = 0;\r\n            event.target.y = 0;\r\n            this.node.dispatchEvent( new cc.Event.EventCustom('takecard', true));\r\n        }\r\n        event.target.x = 0;\r\n        event.target.y = 0;\r\n        cc.sys.localStorage.removeItem('delta');\r\n    },\r\n    touchendClick:function(event){\r\n        let card = event.target.parent.getComponent('HandCards');\r\n        if(cc.sys.localStorage.getItem('alting')!='true'&&cc.sys.localStorage.getItem('ting')!='true'&&!card.caishen){\r\n            var delta = event.touch.getDelta();\r\n            event.target.x += delta.x;\r\n            event.target.y += delta.y;\r\n            cc.sys.localStorage.setItem('delta',event.target.y);\r\n        }\r\n        // console.log('currentTarget:'+event.currentTarget.x);\r\n        // console.log('currentTouch:'+event.currentTouch._point.x);\r\n        // console.log('target:'+event.target.x);\r\n        // console.log('touch:'+event.touch._point.x);\r\n        // console.log('parent:'+ event.target.parent.x+'  '+event.target.parent.name)\r\n        // console.log('------'+Number(event.touch._point.x - event.target.parent.x));\r\n    },\r\n    onClick:function(event){\r\n        let context = cc.find('Canvas').getComponent('MJDataBind');         \r\n        let handCards = this.target.getComponent(\"HandCards\")\r\n        let self = this ;\r\n        if(cc.weijifen.click == 1 &&cc.sys.localStorage.getItem('alting') !='true'){\r\n            this.huifu();            \r\n            this.node.dispatchEvent( new cc.Event.EventCustom('takecard', true) );\r\n        }else{\r\n            if( handCards.take == true){\r\n                //出牌\r\n                if (context.tings&&cc.sys.localStorage.getItem('ting')=='true'){\r\n                    context.tingSelect.active = false;\r\n                    let tinglength = context.tingSelect.children[0].children.length;\r\n                    for(let i = 0 ; i< tinglength ; i++){\r\n                        context.tingSelect.children[0].children[i].destroy();\r\n                    }\r\n                }\r\n                event.target.x = 0;\r\n                event.target.y = 0;\r\n                this.node.dispatchEvent( new cc.Event.EventCustom('takecard', true) );\r\n            }else{\r\n                this.huifu();\r\n                if(cc.sys.localStorage.getItem('alting')=='true'){\r\n                    cc.sys.localStorage.setItem('take','true');                    \r\n                }\r\n                handCards.target.y = handCards.target.y + 20 ;\r\n                handCards.cardvalue.color = new cc.Color(230, 190, 190);\r\n                handCards.take = true;\r\n                if (context.tings&&cc.sys.localStorage.getItem('ting')=='true'){\r\n                    let tinglength = context.tingSelect.children[0].children.length;\r\n                    for(let i = 0 ; i< tinglength ; i++){\r\n                        context.tingSelect.children[0].children[i].destroy();\r\n                    }\r\n                    let chuqu = false;\r\n                    for(let j = 0 ; j< context.tings.length;j++){\r\n                        let cv = context.tings[j].card; \r\n                        if((cv<0&&parseInt(cv/4 )==parseInt(handCards.value/4 ))||(cv>=0&&handCards.mjtype==parseInt(cv/36)&&parseInt((handCards.value%36)/4)==parseInt((cv%36)/4))){\r\n                            let tingcards = context.decode(context.tings[j].cards);\r\n                            console.log(tingcards);\r\n                            context.tingSelect.active = true;                            \r\n                            for(let s = 0 ; s< tingcards.length;s++){\r\n                                let limian = cc.instantiate(context.tingSelectch);\r\n                                // if(context.tings[i].counts){\r\n                                //     limian.getComponent('tingAction').label.string = '还剩:'+context.tings[j].counts.length+'张';\r\n                                // }\r\n                                let cccc = limian.getComponent('tingAction').target.getComponent('HandCards');\r\n                                cccc.init(tingcards[s],true);\r\n                                limian.parent = context.tingSelect.children[0];\r\n                                chuqu = true;\r\n                            }\r\n                            break;\r\n                        }  \r\n                    }\r\n                }\r\n            }    \r\n        }\r\n    }, \r\n    huifu: function(){\r\n        const length  = cc.find('Canvas/cards/handcards/current/currenthandcards').children.length;\r\n        for(let i =0; i<length;i++){\r\n            let cards =cc.find('Canvas/cards/handcards/current/currenthandcards').children[i];\r\n            let handCards = cards.getComponent(\"HandCards\");\r\n            handCards.take = false;\r\n            let button = cc.find('Canvas/cards/handcards/current/currenthandcards').children[i].children[0];                \r\n            \r\n            let card = cards.getComponent('HandCards');\r\n            if(cc.weijifen.cardNum > 14){ \r\n                card.cardvalue.width = 67.5;\r\n                card.cardvalue.height = 102.5;\r\n                cards.width=65.5; \r\n            }else{\r\n                cards.width=73;    \r\n            }\r\n            handCards.target.y = 0;\r\n            if(button.getComponent(cc.Button).interactable&&!card.caishen){\r\n                handCards.cardvalue.color = new cc.Color(255, 255, 255);\r\n            }\r\n        }\r\n    }  \r\n});\r\n"]}