{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\resources\\script\\components/assets\\resources\\script\\components\\LYAudio.js"],"names":["WJFCommon","require","cc","Class","extends","properties","onLoad","init","he","START","END","promise","navigator","mediaDevices","getUserMedia","audio","then","stream","recorder","MediaRecorder","ondataavailable","event","console","log","data","file","FileReader","readAsArrayBuffer","onloadend","ab","ab2str","result","socket","emit","JSON","stringify","userid","weijifen","user","id","start","end","error","browserType","talkPlay","str","str2ab","aud","Audio","blob","Blob","src","URL","createObjectURL","play","talkRecordStart","Date","getTime","find","active","setTimeout","talkRecordEnd","state","stop"],"mappings":";;;;;;AAAA,IAAIA,YAAYC,QAAQ,WAAR,CAAhB;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASJ,SADJ;AAELK,gBAAY,EAFP;AAIL;AACAC,YAAQ,kBAAY;AAChB,aAAKC,IAAL;AACH,KAPI;AAQLA,UAAM,gBAAU;AACZ,YAAIC,KAAK,IAAT;AACAA,WAAGC,KAAH,GAAW,CAAX;AACAD,WAAGE,GAAH,GAAS,CAAT;AACA,YAAG;AACCR,eAAGS,OAAH,GAAWC,UAAUC,YAAV,CAAuBC,YAAvB,CAAoC,EAACC,OAAM,IAAP,EAApC,CAAX;AACAb,eAAGS,OAAH,CAAWK,IAAX,CAAgB,UAASC,MAAT,EAAgB;AAC5Bf,mBAAGgB,QAAH,GAAY,IAAIC,aAAJ,CAAkBF,MAAlB,CAAZ;AACAf,mBAAGgB,QAAH,CAAYE,eAAZ,GAA4B,UAASC,KAAT,EAAe;AACvC;AACAC,4BAAQC,GAAR,CAAYF,MAAMG,IAAlB;AACA,wBAAIC,OAAO,IAAIC,UAAJ,EAAX;AACAD,yBAAKE,iBAAL,CAAuBN,MAAMG,IAA7B;AACAF,4BAAQC,GAAR,CAAYE,IAAZ;AACAA,yBAAKG,SAAL,GAAiB,YAAW;AACxB,4BAAIC,KAAKrB,GAAGsB,MAAH,CAAUL,KAAKM,MAAf,CAAT;AACA,4BAAIC,SAASxB,GAAGwB,MAAH,EAAb;AACAA,+BAAOC,IAAP,CAAY,YAAZ,EAAyBC,KAAKC,SAAL,CAAe;AACpCC,oCAASlC,GAAGmC,QAAH,CAAYC,IAAZ,CAAiBC,EADU;AAEpCd,kCAAOI,EAF6B;AAGpCW,mCAAQhC,GAAGC,KAHyB;AAIpCgC,iCAAMjC,GAAGE;AAJ2B,yBAAf,CAAzB;AAMF,qBATF;AAUH,iBAhBD;AAiBH,aAnBD;AAoBH,SAtBD,CAsBC,OAAMgC,KAAN,EAAY;AACTxC,eAAGmC,QAAH,CAAYM,WAAZ,GAA0B,IAA1B;AACH;AACJ,KArCI;AAsCLC,cAAU,kBAASpB,IAAT,EAAc;AACpB,YAAG,OAAOA,KAAKC,IAAZ,IAAqB,QAAxB,EAAiC;AAC7B,gBAAIoB,MAAO,KAAKC,MAAL,CAAYtB,KAAKC,IAAjB,CAAX;AACA,gBAAIsB,MAAM,IAAIC,KAAJ,EAAV;AACA,gBAAIC,OAAO,IAAIC,IAAJ,CAAS,CAACL,GAAD,CAAT,EAAe,EAAC,QAAO,YAAR,EAAf,CAAX;AACAE,gBAAII,GAAJ,GAAUC,IAAIC,eAAJ,CAAoBJ,IAApB,CAAV;AACA,gBAAGF,IAAIO,IAAP,EAAY;AACRP,oBAAIO,IAAJ;AACH;AACJ;AACJ,KAhDI;AAiDLC,qBAAiB,2BAAU;AACvB,YAAG;AACC,iBAAK9C,KAAL,GAAa,IAAI+C,IAAJ,GAAWC,OAAX,EAAb;AACAvD,eAAGgB,QAAH,CAAYsB,KAAZ;AACH,SAHD,CAGC,OAAME,KAAN,EAAY;AACTxC,eAAGwD,IAAH,CAAQ,WAAR,EAAqBC,MAArB,GAA8B,IAA9B;AACAC,uBAAW,YAAU;AACjB1D,mBAAGwD,IAAH,CAAQ,WAAR,EAAqBC,MAArB,GAA8B,KAA9B;AACH,aAFD,EAEE,IAFF;AAGH;AACJ,KA3DI;AA4DLE,mBAAgB,yBAAU;AACtB,YAAG;AACC,gBAAG3D,GAAGgB,QAAH,CAAY4C,KAAZ,IAAqB,UAAxB,EAAmC;AAC/B,qBAAKpD,GAAL,GAAW,IAAI8C,IAAJ,GAAWC,OAAX,EAAX;AACAvD,mBAAGgB,QAAH,CAAY6C,IAAZ;AACH;AACJ,SALD,CAKC,OAAMrB,KAAN,EAAY,CAEZ;AACJ;AArEI,CAAT","file":"LYAudio.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\script\\components","sourcesContent":["var WJFCommon = require(\"WJFCommon\");\r\ncc.Class({\r\n    extends: WJFCommon,\r\n    properties: {\r\n    },\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.init();\r\n    },\r\n    init: function(){\r\n        let he = this ;\r\n        he.START = 0;\r\n        he.END = 0;\r\n        try{ \r\n            cc.promise=navigator.mediaDevices.getUserMedia({audio:true});\r\n            cc.promise.then(function(stream){\r\n                cc.recorder=new MediaRecorder(stream);\r\n                cc.recorder.ondataavailable=function(event){\r\n                    //收集媒体设备 获得到的 可以使用的 媒体流数据\r\n                    console.log(event.data)\r\n                    var file = new FileReader();\r\n                    file.readAsArrayBuffer(event.data);\r\n                    console.log(file);\r\n                    file.onloadend = function() {              \r\n                        let ab = he.ab2str(file.result);\r\n                        let socket = he.socket();\r\n                        socket.emit('sayOnSound',JSON.stringify({\r\n                            userid : cc.weijifen.user.id,\r\n                            file : ab,\r\n                            start : he.START,\r\n                            end : he.END\r\n                        })\r\n                    )}\r\n                }\r\n            });\r\n        }catch(error){\r\n            cc.weijifen.browserType = null;\r\n        }\r\n    },\r\n    talkPlay: function(data){\r\n        if(typeof(data.file) == 'string'){\r\n            let str =  this.str2ab(data.file);\r\n            var aud = new Audio();\r\n            var blob = new Blob([str],{'type':'video/webm'}) ;\r\n            aud.src = URL.createObjectURL(blob);\r\n            if(aud.play){\r\n                aud.play() ;\r\n            } \r\n        }  \r\n    },\r\n    talkRecordStart: function(){\r\n        try{        \r\n            this.START = new Date().getTime();\r\n            cc.recorder.start();\r\n        }catch(error){\r\n            cc.find('Canvas/YY').active = true;\r\n            setTimeout(function(){\r\n                cc.find('Canvas/YY').active = false;                \r\n            },2000);\r\n        }\r\n    },\r\n    talkRecordEnd : function(){\r\n        try{        \r\n            if(cc.recorder.state != 'inactive'){\r\n                this.END = new Date().getTime(); \r\n                cc.recorder.stop();\r\n            } \r\n        }catch(error){\r\n\r\n        }   \r\n    }\r\n});\r\n"]}